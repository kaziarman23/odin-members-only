<% layout('layout') -%>

<h2>Club Messages</h2>

<% if (currentUser) { %>
<p><a href="/messages/new">+ Create a new message</a></p>
<% } %>

<ul class="message-list">
  <% if (messages.length === 0) { %>
  <li>No messages yet. Be the first to post!</li>
  <% } %> <% messages.forEach(m => { %>
  <li class="message">
    <h3><%= m.title %></h3>
    <p><%= m.text %></p>

    <% if (currentUser && (currentUser.isMember || currentUser.isAdmin)) { %>
    <small
      >By <%= m.author ? m.author.firstName + ' ' + m.author.lastName :
      'unknown' %> on <%= new Date(m.createdAt).toLocaleString() %></small
    >
    <% } else { %>
    <small>Posted (author hidden â€” members only)</small>
    <% } %> <% if (currentUser && currentUser.isAdmin) { %>
    <form
      action="/messages/<%= m.id %>/delete"
      method="post"
      style="display: inline"
    >
      <button type="submit">Delete</button>
    </form>
    <% } %>
  </li>
  <% }) %>
</ul>
